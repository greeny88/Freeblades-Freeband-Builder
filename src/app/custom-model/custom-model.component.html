<div id="custommodel">
  <div *ngIf="!trainingDone">Loading...</div>
  <form [formGroup]="characterForm" *ngIf="trainingDone">
    <div class="character-builder">
      <h2>Character Builder</h2>

      <div class="form-section">
        <label>Character Type:</label>
        <select formControlName="type" (change)="onTypeChange($event)">
          <option value="Standard">Standard</option>
          <option value="Leader">Leader</option>
          <option value="Caster">Caster</option>
        </select>
      </div>

      <div class="form-section" formGroupName="stats">
        <label>Model Type:</label>
        <select formControlName="type" (change)="onModelTypeChange($event)" [disabled]="isModelTypeDisabled()">
          <option value="Follower">Follower</option>
          <option value="Hero">Hero</option>
        </select>

        <label>Melee Weapons</label>
        <div class="weapon-selections">
          <div formArrayName="melee">
            <button type="button" (click)="addWeapon('melee')">Add Weapon</button>
            <div *ngFor="let weaponControl of melee.controls; let i = index" [formGroupName]="i" class="weapon-rating-pair">
              <select formControlName="weapon">
                <option value="">Select Weapon</option>
                <option *ngFor="let weapon of meleeWeapons" [ngValue]="weapon">{{ weapon.name }}</option>
              </select>
              <input type="number" formControlName="rating" min="0" step="2">
              <button type="button" (click)="removeWeapon('melee', i)">Remove</button>
            </div>
          </div>
        </div>

        <label>Ranged Weapons</label>
        <div class="weapon-selections">
          <div formArrayName="range">
            <button type="button" (click)="addWeapon('range')">Add Weapon</button>
            <div *ngFor="let weaponControl of range.controls; let i = index" [formGroupName]="i" class="weapon-rating-pair">
              <select formControlName="weapon">
                <option value="">Select Weapon</option>
                <option *ngFor="let weapon of rangeWeapons" [ngValue]="weapon">{{ weapon.name }}</option>
              </select>
              <input type="number" formControlName="rating" min="0" step="2">
              <button type="button" (click)="removeWeapon('range', i)">Remove</button>
            </div>
          </div>
        </div>

        <label>Talents</label>
        <select multiple formControlName="talents">
          <option *ngFor="let talent of talents" [value]="talent">{{ talent }}</option>
        </select>

        <label>Skills</label>
        <select multiple formControlName="skills">
          <option *ngFor="let skill of skills" [value]="skill">{{ skill }}</option>
        </select>

        <div class="abilities" formGroupName="abilities">
          <h3>Abilities</h3>
          <div class="ability-inputs">
            <label>Strength: 
              <input type="number" 
                     formControlName="strength" 
                     min="0" 
                     step="2">
            </label>
            <label>Agility: 
              <input type="number" 
                     formControlName="agility" 
                     min="0" 
                     step="2">
            </label>
            <label>Dexterity: 
              <input type="number" 
                     formControlName="dexterity" 
                     min="0" 
                     step="2">
            </label>
            <label>Endurance: 
              <input type="number" 
                     formControlName="endurance" 
                     min="0" 
                     step="2">
            </label>
            <label>Knowledge: 
              <input type="number" 
                     formControlName="knowledge" 
                     min="0" 
                     step="2">
            </label>
            <label>Spirit: 
              <input type="number" 
                     formControlName="spirit" 
                     min="0" 
                     step="2">
            </label>
          </div>
        </div>

        <div class="stats">
          <label>Armor: <input type="number" formControlName="armor" min="0"></label>
          <label>Discipline: <input type="number" formControlName="discipline" min="0" step="2"></label>
          <label>Speed: <input type="number" formControlName="speed" min="0"></label>
          <label>Shield: <input type="checkbox" formControlName="shield"></label>
        </div>
      </div>

      <button (click)="predictCost()">Predict Cost</button>

      <div *ngIf="predictedCost !== null" class="prediction">
        <h3>Predicted Cost: {{ predictedCost }}</h3>
      </div>
    </div>
  </form>
</div>