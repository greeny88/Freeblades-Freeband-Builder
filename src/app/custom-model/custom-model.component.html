<div id="custommodel">
  <div class="loading-container" *ngIf="!trainingDone">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    <div class="loading-text">
      {{ currentLoadingText }}
    </div>
  </div>
  
  <form [formGroup]="characterForm" *ngIf="trainingDone" class="form-container">
    <h2 class="mat-headline-4">Character Builder</h2>

    <div class="form-section">
      <mat-form-field>
        <mat-label>Character Type</mat-label>
        <mat-select formControlName="type" (selectionChange)="onTypeChange($event)">
          <mat-option value="Standard">Standard</mat-option>
          <mat-option value="Leader">Leader</mat-option>
          <mat-option value="Caster">Caster</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="form-section" formGroupName="stats">
      <mat-form-field>
        <mat-label>Model Type</mat-label>
        <mat-select formControlName="type" (selectionChange)="onModelTypeChange($event)" [disabled]="isModelTypeDisabled()">
          <mat-option value="Follower">Follower</mat-option>
          <mat-option value="Hero">Hero</mat-option>
        </mat-select>
      </mat-form-field>

      <h3 class="mat-subtitle-1">Melee Weapons</h3>
      <div class="weapon-selections" formArrayName="melee">
        <button mat-raised-button class="mat-accent" type="button" style="margin-bottom:1em;" (click)="addWeapon('melee')">
          <mat-icon>add</mat-icon> Add Weapon
        </button>
        
        <div *ngFor="let weaponControl of melee.controls; let i = index" [formGroupName]="i" class="weapon-rating-pair">
          <mat-form-field>
            <mat-label>Select Weapon</mat-label>
            <mat-select formControlName="weapon">
              <mat-option [value]="null">Select Weapon</mat-option>
              <mat-option *ngFor="let weapon of meleeWeapons" [value]="weapon">
                {{weapon.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Rating</mat-label>
            <input matInput type="number" formControlName="rating" min="0" step="2">
          </mat-form-field>

          <button mat-icon-button color="warn" type="button" (click)="removeWeapon('melee', i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>

      <h3 class="mat-subtitle-1">Ranged Weapons</h3>
      <div class="weapon-selections" formArrayName="range">
        <button mat-raised-button class="mat-accent" type="button" style="margin-bottom:1em;" (click)="addWeapon('range')">
          <mat-icon>add</mat-icon> Add Weapon
        </button>
        
        <div *ngFor="let weaponControl of range.controls; let i = index" [formGroupName]="i" class="weapon-rating-pair">
          <mat-form-field>
            <mat-label>Select Weapon</mat-label>
            <mat-select formControlName="weapon">
              <mat-option [value]="null">Select Weapon</mat-option>
              <mat-option *ngFor="let weapon of rangeWeapons" [value]="weapon">
                {{weapon.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Rating</mat-label>
            <input matInput type="number" formControlName="rating" min="0" step="2">
          </mat-form-field>

          <button mat-icon-button color="warn" type="button" (click)="removeWeapon('range', i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>

      <h3 class="mat-subtitle-1">Talents</h3>
      <div formArrayName="talents" class="talent-selections">
        <button mat-raised-button class="mat-accent" type="button" style="margin-bottom:1em;" (click)="addTalent()">
          <mat-icon>add</mat-icon> Add Talent
        </button>
        
        <div *ngFor="let talentControl of talent.controls; let i = index" class="talent-selection">
          <mat-form-field>
            <mat-label>Select Talent</mat-label>
            <mat-select [formControlName]="i">
              <mat-option [value]="null">Select Talent</mat-option>
              <mat-option *ngFor="let talent of talents" [value]="talent">
                {{talent}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <button mat-icon-button color="warn" type="button" (click)="removeTalent(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>

      <h3 class="mat-subtitle-1">Skills</h3>
      <mat-form-field>
        <mat-label>Skills</mat-label>
        <mat-select multiple formControlName="skills">
          <mat-option *ngFor="let skill of skills" [value]="skill">{{skill}}</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="abilities" formGroupName="abilities">
        <h3 class="mat-subtitle-1">Abilities</h3>
        <div class="ability-inputs">
          <mat-form-field>
            <mat-label>Strength</mat-label>
            <input matInput type="number" formControlName="strength" min="0" step="2">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Agility</mat-label>
            <input matInput type="number" formControlName="agility" min="0" step="2">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Dexterity</mat-label>
            <input matInput type="number" formControlName="dexterity" min="0" step="2">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Endurance</mat-label>
            <input matInput type="number" formControlName="endurance" min="0" step="2">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Knowledge</mat-label>
            <input matInput type="number" formControlName="knowledge" min="0" step="2">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Spirit</mat-label>
            <input matInput type="number" formControlName="spirit" min="0" step="2">
          </mat-form-field>
        </div>
      </div>

      <div class="stats">
        <h3 class="mat-subtitle-1">Other</h3>
        <mat-form-field>
          <mat-label>Armor</mat-label>
          <input matInput type="number" formControlName="armor" min="0">
        </mat-form-field>

        <mat-form-field>
          <mat-label>Discipline</mat-label>
          <input matInput type="number" formControlName="discipline" min="0" step="2">
        </mat-form-field>

        <mat-form-field>
          <mat-label>Speed</mat-label>
          <input matInput type="number" formControlName="speed" min="0">
        </mat-form-field>

        <mat-checkbox formControlName="shield">Shield</mat-checkbox>

        <mat-checkbox formControlName="casting">Magic</mat-checkbox>
      </div>
    </div>

    <button mat-raised-button class="mat-accent" (click)="predictCost()">
      <mat-icon>calculate</mat-icon>
      Predict Cost
    </button>

    <mat-card *ngIf="predictedCost !== null" class="prediction-card">
      <mat-card-content>
        <h3 class="mat-headline-6">Predicted Cost: {{ predictedCost }}</h3>
      </mat-card-content>
    </mat-card>
  </form>
</div>